#!/bin/bash

currdate=`date`
lastprod=(`tail -n 1000 /opt/eosio/deploy/data/stderr.txt | grep 'Received\|Produced' | grep quantumblok | tail -n 1| awk '{print $2}'`)
diff=$(( $(date -d "$currdate" "+%s") - $(date -d "$lastprod" "+%s") ))
if (( "$diff" < "120" )); then
        printf "\n$currdate - "
        curl -s http://127.0.0.1:8888/v1/producer/paused
        /usr/local/bin/telegram-send "ðŸš€ Everything is fine on backup node due to $lastprod being 2 min from $currdate."
else
        printf "\n$currdate - Resuming production - "
        curl -s http://127.0.0.1:8888/v1/producer/resume
        /usr/local/bin/telegram-send "ðŸ”¥ Resumed production on backup node due to $lastprod being 2 min from $currdate."
fi